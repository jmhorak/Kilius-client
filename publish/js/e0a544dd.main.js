function KiliusLink(e){var t=this;e=e||{},t.shortLink=e.short||"",t.longLink=e.long||"",t.hits=e.hits||0,t.date=e.date||new Date,t.clip=null,t.positionStale=ko.observable(!1),t.updatePosition=ko.computed(function(){return t.positionStale()}).extend({throttle:300}),t.displayShortLink=ko.computed(function(){var e=t.shortLink;return e.substring(e.indexOf("kili"))})}function KiliusModel(){var e=this,t="webkitTransitionEnd transitionend MSTransitionEnd oTransitionEnd";e.user="k",e.supportAnimation=$("html").hasClass("cssanimations"),e.supportFlash=function(){var e=navigator.mimeTypes["application/x-shockwave-flash"];return e?!!e.enabledPlugin:!1}(),e.links=ko.observableArray([]),e.newLink=ko.observable(),e.errorMsg=ko.computed({read:function(){return kilius.comms.errorMsg()},write:function(e){kilius.comms.errorMsg(e)}}),e.animations={ready:ko.observable(!0),main:{play:ko.observable(!0)},table:{play:ko.observable(!1)}},e.animations.enabled=ko.computed(function(){return e.supportAnimation&&e.animations.ready()}),e.animations.main.shown=ko.computed(function(){return!e.supportAnimation||e.animations.main.play()}),e.animations.table.shown=ko.computed(function(){return!e.supportAnimation||e.animations.table.play()}),e.playTableAnimation=function(){e.links().length>0&&!e.animations.table.shown()&&e.animations.table.play(!0)},e.postLink=function(){kilius.comms.postNewLink(e.newLink(),e.addNewLink)},e.repositionCopyLinks=function(){$.each(e.links(),function(e,t){t.positionStale(!0)})},e.addUserHistoryFromJSON=function(t){var n=t.history||[];n.sort(function(e,t){return t.date-e.date}),$.each(n,function(t,n){e.links.push(new KiliusLink(n))}),e.playTableAnimation()},e.addNewLink=function(t){e.links.unshift(new KiliusLink({"short":t,"long":e.newLink(),hits:0,date:new Date})),e.newLink(""),e.errorMsg(""),e.playTableAnimation(),e.repositionCopyLinks()},$("#mainBox").bind(t,function(t){t.target===this&&(e.playTableAnimation(),$("#bigK").addClass("softenDark"))}),$(window).resize(e.repositionCopyLinks),kilius.comms.getUserHistory(e.user,e.addUserHistoryFromJSON)}function KiliusComms(){var e=this;e.errorMsg=ko.observable(""),e.getUserHistory=function(e,t){$.getJSON("/"+e+"/history",t)},e.postNewLink=function(t,n){$.ajax({url:"/+/",type:"POST",data:JSON.stringify({url:t}),contentType:"application/json",processData:!1,error:e.onLinkAddError,success:function(t,r,i){e.onLinkAddSuccess(i,n)}})},e.onLinkAddError=function(t,n,r){var i=null;try{i=JSON.parse(t.responseText),i=i.message}catch(s){i=null}i||(i=["The Kili.us server reported a problem: ",n?n[0].toUpperCase()+n.slice(1):"Error"," - ",r?r:"General Error"].join("")),e.errorMsg(i)},e.onLinkAddSuccess=function(t,n){t.status===201?n(t.getResponseHeader("Location")):e.errorMsg("The server did not reply to the request in the correct format")},$.ajaxSetup({dataType:"json"})}(!window.console||!console.log)&&function(){var e=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","markTimeline","table","time","timeEnd","timeStamp","trace","warn"],n=t.length,r=window.console={};while(n--)r[t[n]]=e}(),ko.bindingHandlers.opacity={init:function(e,t){t()?$(e).addClass("opaque"):$(e).addClass("transparent")},update:function(e,t){t()?$(e).removeClass("transparent").addClass("opaque"):$(e).removeClass("opaque").addClass("transparent")}},ko.bindingHandlers.copyElement={init:function(e,t,n,r){r.clip=new ZeroClipboard.Client,r.clip.setText(r.shortLink),r.clip.setHandCursor(!0),r.clip.setCSSEffects(!0)},update:function(e,t,n,r){t()&&(r.clip.domElement||r.clip.glue(e),r.clip.reposition(),r.positionStale(!1))}},window.kilius={},$(document).ready(function(){setTimeout(function(){kilius.comms=new KiliusComms,kilius.model=new KiliusModel,ko.applyBindings(kilius.model),ZeroClipboard.setMoviePath("/flash/ZeroClipboard.swf")},1)});